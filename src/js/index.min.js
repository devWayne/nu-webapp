function dpbox(e,t){this.defaults={width:"auto",height:"auto",overlay:"false",type:"Modal"},this.opts=$.extend(this.opts,this.defaults,t),this._create=function(){this.container||(this.container=$("<div/>",{"class":"dpbox"}).css("display","none").appendTo($("body")),this.header=$("<div/>",{"class":"dpbox-header"}).appendTo(this.container),this.title=$("<div/>",{"class":"dpbox-title"}).appendTo(this.header).css("display","inline"),this.clzBtn=$("<div/>",{"class":"dpbox-clzBtn"}).appendTo(this.header).html("X").css("display","inline").on("click",this.close.bind(this)),this.content=$("<div/>",{"class":"dpbox-content"}).css({width:this.opts.width,height:this.opts.height}).appendTo(this.container),this.setTitle(this.opts.title),this.setContent(this.opts.content),"Confirm"==this.opts.btn&&(this.bottom=$("<div/>",{"class":"dpbox-bottom"}).appendTo(this.container),this.setConfirmBtn()))},this.container||this._create()}$(function(){function e(e){$.ajax({url:x,type:"GET",dataType:"json",data:e,success:function(e){t(e.items[0],$(".detail-list-free")),$(".nav-bar-text").eq(0).text(e.items[0].name),e.items.length>1?(t(e.items[1],$(".detail-list-lijian")),$(".nav-bar-text").eq(1).text(e.items[1].name)):($(".detail-list-lijian").hide(),$(".detail-list-lijian").next().hide(),$(".detail-list-lijian").prev().hide()),n()}})}function t(e,t){h&&u?($(e.dealGroups).each(function(e,t){t.imageUrl=t.imageUrl.replace("450c280","120c90"),t.geoLocations.length>1&&h?(t.value=[],$(t.geoLocations).each(function(e){t.value[e]=U.value({latitude:h,longitude:u},t.geoLocations[e])}),t.sortValue=Math.min.apply(Math,t.value),t.distance=U.distance(t.sortValue)):t.geoLocations[0]&&h?(t.sortValue=U.value({latitude:h,longitude:u},t.geoLocations[0]),t.distance=U.distance(t.sortValue)):(void 0==t.geoLocations[0]||""==t.geoLocations[0])&&(t.sortValue=0),0==t.remain&&(t.sortValue=-1)}),e.dealGroups.sort(function(e,t){return e.sortValue&&t.sortValue?e.sortValue-t.sortValue:void 0}),t.append(Mustache.render(dealTpl.deal,e)),t.children().length>C?t.children().each(function(e){e+1>C&&t.children().eq(e).hide()}):t.next().hide(),t.next().on("click",function(){for(var e=C;C+_>e;e++)t.children().eq(e).show();C+=_,(C>t.children().length||C==t.children().length)&&$(this).hide()})):(t.append(Mustache.render(dealTpl.deal,e)),t.children().length>C&&t.children().each(function(e){e+1>C&&t.children().eq(e).hide()}),t.next().on("click",function(){for(var e=C;C+_>e;e++)t.children().eq(e).show();(C>t.children().length||C==t.children().length)&&$(this).hide(),C+=_}))}function n(){var e={};e.couponRuleID=f,e.dpid=l,$.cookie("dper")?e.dper=$.cookie("dper"):e.token=httpUtils.getParam("token"),$.ajax({async:!1,url:y,type:"GET",dataType:"jsonp",data:e,jsonp:"jsonp",success:function(e){e.success&&0==e.realtime_tg_fresh?$(".container.op-box").append('<img src="http://www.dpfile.com/mfchwl/img/lyhneww.png">'):($(".buy-btn").hide(),$(".free-buy-btn").show(),$(".price strong").text("0")),o(e)},error:function(e){$(".buy-btn").hide(),$(".free-buy-btn").show(),$(".price strong").text("0"),o(e)}})}function o(e){$(".free-buy-item").on("click",function(t){t.preventDefault();var n=$(t.target).parents("a").attr("data-tuandealid"),o=$(t.target).attr("discountRuleId"),i=w+"/tuan/eventdeal/"+n+"?"+m+"&discountRuleId="+o,r=w+"/tuan/eventdeal/"+n+"?"+v,s="dianping://tuandeal?id="+n;return _hip.push(["mv",{module:"5_mfchwl_jw",action:"click",campaignid:1303,camp_step:"home"}]),p.replace(/\./,"")<68.5?(k.showOverlay(0),void k.centershow(".popbox")):0==e.success?void(location.href="dianping://loginweb?url="+encodeURIComponent(w+"/login/app?version="+p+"&logintype=m")+"&goto="+encodeURIComponent("dianping://complexweb?url="+encodeURIComponent(r))):0==e.realtime_tg_fresh?void(location.href=s):e.integrity_score<=0?($.removeCookie("dper"),void(location.href="dianping://loginweb?url="+encodeURIComponent(w+"/login/app?version="+p+"&logintype=m")+"&goto="+encodeURIComponent("dianping://complexweb?url="+encodeURIComponent(r)))):e.mobile?e.integrity_score>9980?void DPApp.show_alert({title:"提示",message:"活动爆棚啦，放眼望去人山人海，先喝口茶歇歇吧～",options:[],cancel:"好的"},function(){location.href="dianping://home"}):e.integrity_score>5e3&&e.integrity_score<=9980&&1==e.up_sms?void(location.href=b+"/lab/common/uploadSmsCheck?eventId="+f+"&token="+d+"&bizType=2&callback="+encodeURIComponent(i)):void(location.href=i):void(location.href="dianping://modifyphone?goto="+encodeURIComponent("dianping://complexweb?url="+r)+"&url="+encodeURIComponent(w+"/account/modifyMobile?newtoken=!"))})}function i(){e(),share.shareBtn(),share.initShare(),r.on("click",function(e){e.preventDefault(),k.showOverlay(1),$(".popbox").hide()}),s.on("click",function(e){return e.preventDefault(),window.location.href="http://m.dianping.com/download/synthesislink?redirect=3130&tag=external",!1})}var r=$(".j-back"),s=$(".j-update"),a=(httpUtils.getParam("eventId"),httpUtils.getParam("eventName")),c=httpUtils.getParam("cityid"),l=httpUtils.getParam("dpid"),p=httpUtils.getParam("version"),d=httpUtils.getParam("token"),h=httpUtils.getParam("latitude"),u=httpUtils.getParam("longitude"),f=httpUtils.getParam("couponRuleID"),g=httpUtils.getParam("env");(void 0==typeof a||""==a)&&(a="mfchwlzs"),(void 0==typeof f||""==f)&&(f="102201"),(void 0==typeof g||""==g)&&(g="product");var m="eventName="+a+"&cityid="+c+"&version="+p+"&token="+d+"&latitude="+h+"&longitude="+u+"&dpid="+l+"&couponRuleID="+f+"&source=1",v="eventName="+a+"&cityid="+c+"&version="+p+"&token=*&latitude="+h+"&longitude="+u+"&dpid="+l+"&couponRuleID="+f+"&source=1",w="http://m.dianping.com",b="http://t.dianping.com",y="http://mm.dianping.com/weixin/promotion/user-profile/jsonp?evt=mfchwl",x="http://evt.dianping.com/1493/json/"+c+".json";"product"!=g&&(x="http://evt.dianping.dp/1493/json/"+c+".json",y="http://mm.51ping.com/weixin/promotion/user-profile/jsonp?evt=mfchwl",w="http://m.51ping.com",b="http://t.51ping.com");var k={showOverlay:function(e){var t=$('<div id="J_overlay" style="position:absolute;left:0;top:0;background:#000;_filter:alpha(opacity=50);z-index:999;"></div>');e?$("#J_overlay").remove():t.appendTo($("body")).css({width:$(window).width(),height:"1700px",opacity:.5})},centershow:function(e){var t=($(window).height()-140)/2,n=($(window).width()-$(e).css("width").substring(0,3))/2,o=$(window).scrollTop()||0,i=$(window).scrollLeft()||0;$(e).css({position:"absolute",top:t+o,left:n+i}).show()}},U=new geo,C=10,_=100;i()});var dealTpl={deal:'{{#dealGroups}}<a class="J_deal" data-tuandealid="{{id}}">	 <div class="item {{#hasPromo}}free-buy-item{{/hasPromo}} {{^hasPromo}}none-free-buy-item{{/hasPromo}}">            <div class="pic">                <img src="{{imageUrl}}">            </div>            <div class="info">                <h3>{{dealGroupShortName}}<span class="geo">{{distance}}</span></h3>                <h4>{{recommendReason}}</h4>                <div class="buy-box Fix">                    <div class="price-box f-l">                        <span class="price">¥<strong>{{price}}</strong></span>                        <span class="o-price">¥<strong>{{marketPrice}}</strong></span>                    </div>                        <span class="buy-btn f-r">去团购</span>			{{#hasPromo}}<span class="free-buy-btn f-r" data-discountRuleId="{{discountRuleId}}" style="display:none;">免费领</span>{{/hasPromo}}			{{^hasPromo}}<span class="free-buy-btn f-r sold-out" style="display:none;">抢光了</span>{{/hasPromo}}                </div>            </div>	  </div>        </a>{{/dealGroups}}'},callbacksCount=1,callbacks={};window.DPApp={send_message:function(e,t,n){var o=n&&"function"==typeof n,i=o?callbacksCount++:0;o&&(callbacks[i]=n),t.callbackId=i,t="object"==typeof t?JSON.stringify(t):t+"";var r="js://_?method="+e+"&args="+encodeURIComponent(t)+"&callbackId="+i,s=document.createElement("IFRAME");s.setAttribute("src",r),s.setAttribute("height","1px"),s.setAttribute("width","1px"),document.documentElement.appendChild(s),s.parentNode.removeChild(s),s=null},callback:function(e,t){try{var n=callbacks[e];if(!n)return;n.apply(null,[t])}catch(o){alert(o)}},show_alert:function(e,t){DPApp.send_message("show_alert",e,function(e){t instanceof Function&&t(e.select)})},send_sms:function(e,t){DPApp.send_message("send_sms",{content:e,recipients:t})},open_web:function(e,t){DPApp.send_message("open_web",{modal:e,url:t})},close_web:function(e){DPApp.send_message("close_web",{modal:e})},shareConfig:{url:"http://t1.dpfile.com/t/html/app/events/zonefreeeating1017/index.html?"+ +new Date,image:"http://i1.s1.dpfile.com/pc/tgzt/5e6bd31183e7f5ea30ec611bddc9dfae(1600c550)/thumb.jpg",title:"大众点评豪掷10亿，请新用户免费吃喝玩乐",desc:"吃喝玩乐，通通不要钱，大众点评新用户专享!"}},dpbox.prototype.setContent=function(e){(null!=e||this.container)&&this.content.html(e)},dpbox.prototype.setTitle=function(e){(null!=e||this.container)&&this.title.html(e)},dpbox.prototype.setConfirmBtn=function(){var e="<div class='buttons'><a href='' class='bn-yel bn-sm'>确定</a><a href='' class='bn-ash bn-sm'>取消</a></div>";this.bottom.html(e)},dpbox.prototype.open=function(){var e=function(){var e=($(window).height()-$(this.container).height())/2,t=($(window).width()-$(this.container).width())/2,n=$(document).scrollTop(),o=$(document).scrollLeft();$(this.container).css({position:"absolute",top:e+n,left:t+o}).show()}.bind(this);this.Opening?e():(this.Opening=!this.Opening,this.opts.overlay&&(this.overlay=$('<div style="background-color: rgb(0, 0, 0); border-top-width: 1px; border-top-style: solid; border-top-color: rgb(0, 0, 0); position: absolute; height: 1557px;width: 100%; left: 0px; top: 0px; opacity: 0.7; tp-a"></div>').appendTo($("body"))),e())},dpbox.prototype.close=function(){this.Opening?(this.Opening=!this.Opening,this.opts.overlay&&this.overlay.css({display:"none"}),this.container.css({display:"none"})):this.container.css({display:"none",opacity:0})},$.dpbox=function(e,t){return t||(t={}),new dpbox(e,$.extend(t,$.fn.dpbox.defaults))};var geo=function(){},proto=geo.prototype;proto.constructor=geo,proto.distance=function(e){if(e>1){var t=e-e%1;return">"+t.toString()+"km"}var n=parseInt(1e3*e);return n.toString()+"m"},proto.value=function(e,t){var n=Math.PI/180,o=(180/Math.PI,6371),i=2*o,r=e.latitude,s=e.longitude,a=t.latitude,c=t.longitude,l=a*n,p=c*n,d=r*n-l,h=s*n-p,u=Math.sin(.5*d),f=Math.sin(.5*h),g=Math.cos(r*n),m=u*u+g*Math.cos(l)*f*f;return i*Math.atan2(Math.sqrt(m),Math.sqrt(1-m))},proto.getLocation=function(e,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){window.latitude=t.coords.latitude,window.longitude=t.coords.longitude,e&&e instanceof Function&&e()},function(){t&&t instanceof Function&&t()}):console.log("Geolocation is not supported by this browser.")};var httpUtils={getParam:function(e){var t="";if(isFound=!1,0==window.location.search.indexOf("?")&&window.location.search.indexOf("=")>1)for(arrSource=unescape(window.location.search).substring(1,window.location.search.length).split("&"),i=0;i<arrSource.length&&!isFound;)arrSource[i].indexOf("=")>0&&arrSource[i].split("=")[0].toLowerCase()==e.toLowerCase()&&(t=arrSource[i].split("=")[1],isFound=!0),i++;return t}},lazyAttr="lazy-src",LazyLoad=function(e){var t=e.get().filter(function(e){return!!$(e).attr(lazyAttr)}),n=t.length,o=function(){for(var e=$(window).scrollTop()+window.innerHeight,i=0,r=t.length;r>i;i++){var s=$(t[i]);!s.attr("src")&&s.attr(lazyAttr)&&e>$(s).offset().top&&(s.attr("src",s.attr(lazyAttr)),n--)}0>=n&&window.removeEventListener("scroll",o,!1)};window.addEventListener("load",o,!1),window.addEventListener("scroll",o,!1),o()},share={shareBtn:function(){var e=document.createElement("div");e.style.display="none",e.innerHTML='<div id="shareBox" class="share-tips"><i></i><p>点击右上角按钮分享给好友</p></div>',document.body.appendChild(e),e.addEventListener("click",function(){e.style.display="none"}),$("#J_guide_share").on("click",function(t){t.preventDefault(),e.style.display="block"})},initShare:function(){var e=document.createElement("iframe"),t=document.createElement("div"),n="dpshare://_?content="+encodeURIComponent(JSON.stringify(DPApp.shareConfig));t.setAttribute("style","display:none"),t.appendChild(e),document.body.appendChild(t),e.setAttribute("src",n)}};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):Zepto)}(function(e){function t(e){return a.raw?e:encodeURIComponent(e)}function n(e){return a.raw?e:decodeURIComponent(e)}function o(e){return t(a.json?JSON.stringify(e):String(e))}function i(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(s," ")),a.json?JSON.parse(e):e}catch(t){}}function r(t,n){var o=a.raw?t:i(t);return e.isFunction(n)?n(o):o}var s=/\+/g,a=e.cookie=function(i,s,c){if(arguments.length>1&&!e.isFunction(s)){if(c=e.extend({},a.defaults,c),"number"==typeof c.expires){var l=c.expires,p=c.expires=new Date;p.setTime(+p+864e5*l)}return document.cookie=[t(i),"=",o(s),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}for(var d=i?void 0:{},h=document.cookie?document.cookie.split("; "):[],u=0,f=h.length;f>u;u++){var g=h[u].split("="),m=n(g.shift()),v=g.join("=");if(i&&i===m){d=r(v,s);break}i||void 0===(v=r(v))||(d[m]=v)}return d};a.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),function(e,t){"object"==typeof exports&&exports?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Mustache={})}(this,function(e){function t(e){return"function"==typeof e}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return f.call(e,t)}function i(e){return!o(g,e)}function r(e){return String(e).replace(/[&<>"'\/]/g,function(e){return m[e]})}function s(t,o){function r(){if(k&&!$)for(;m.length;)delete g[m.pop()];else m=[];k=!1,$=!1}function s(e){if("string"==typeof e&&(e=e.split(w,2)),!u(e)||2!==e.length)throw new Error("Invalid tags: "+e);p=new RegExp(n(e[0])+"\\s*"),d=new RegExp("\\s*"+n(e[1])),h=new RegExp("\\s*"+n("}"+e[1]))}if(!t)return[];var p,d,h,f=[],g=[],m=[],k=!1,$=!1;s(o||e.tags);for(var U,C,_,j,I,P,T=new l(t);!T.eos();){if(U=T.pos,_=T.scanUntil(p))for(var R=0,E=_.length;E>R;++R)j=_.charAt(R),i(j)?m.push(g.length):$=!0,g.push(["text",j,U,U+1]),U+=1,"\n"===j&&r();if(!T.scan(p))break;if(k=!0,C=T.scan(x)||"name",T.scan(v),"="===C?(_=T.scanUntil(b),T.scan(b),T.scanUntil(d)):"{"===C?(_=T.scanUntil(h),T.scan(y),T.scanUntil(d),C="&"):_=T.scanUntil(d),!T.scan(d))throw new Error("Unclosed tag at "+T.pos);if(I=[C,_,U,T.pos],g.push(I),"#"===C||"^"===C)f.push(I);else if("/"===C){if(P=f.pop(),!P)throw new Error('Unopened section "'+_+'" at '+U);if(P[1]!==_)throw new Error('Unclosed section "'+P[1]+'" at '+U)}else"name"===C||"{"===C||"&"===C?$=!0:"="===C&&s(_)}if(P=f.pop())throw new Error('Unclosed section "'+P[1]+'" at '+T.pos);return c(a(g))}function a(e){for(var t,n,o=[],i=0,r=e.length;r>i;++i)t=e[i],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(o.push(t),n=t));return o}function c(e){for(var t,n,o=[],i=o,r=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":i.push(t),r.push(t),i=t[4]=[];break;case"/":n=r.pop(),n[5]=t[2],i=r.length>0?r[r.length-1][4]:o;break;default:i.push(t)}return o}function l(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function d(){this.cache={}}var h=Object.prototype.toString,u=Array.isArray||function(e){return"[object Array]"===h.call(e)},f=RegExp.prototype.test,g=/\S/,m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},v=/\s*/,w=/\s+/,b=/\s*=/,y=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},l.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var n,o=this.cache;if(e in o)n=o[e];else{for(var i,r,s=this;s;){if(e.indexOf(".")>0)for(n=s.view,i=e.split("."),r=0;null!=n&&r<i.length;)n=n[i[r++]];else n=s.view[e];if(null!=n)break;s=s.parent}o[e]=n}return t(n)&&(n=n.call(this.view)),n},d.prototype.clearCache=function(){this.cache={}},d.prototype.parse=function(e,t){var n=this.cache,o=n[e];return null==o&&(o=n[e]=s(e,t)),o},d.prototype.render=function(e,t,n){var o=this.parse(e),i=t instanceof p?t:new p(t);return this.renderTokens(o,i,n,e)},d.prototype.renderTokens=function(n,o,i,r){function s(e){return p.render(e,o,i)}for(var a,c,l="",p=this,d=0,h=n.length;h>d;++d)switch(a=n[d],a[0]){case"#":if(c=o.lookup(a[1]),!c)continue;if(u(c))for(var f=0,g=c.length;g>f;++f)l+=this.renderTokens(a[4],o.push(c[f]),i,r);else if("object"==typeof c||"string"==typeof c)l+=this.renderTokens(a[4],o.push(c),i,r);else if(t(c)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");c=c.call(o.view,r.slice(a[3],a[5]),s),null!=c&&(l+=c)}else l+=this.renderTokens(a[4],o,i,r);break;case"^":c=o.lookup(a[1]),(!c||u(c)&&0===c.length)&&(l+=this.renderTokens(a[4],o,i,r));break;case">":if(!i)continue;c=t(i)?i(a[1]):i[a[1]],null!=c&&(l+=this.renderTokens(this.parse(c),o,i,c));break;case"&":c=o.lookup(a[1]),null!=c&&(l+=c);break;case"name":c=o.lookup(a[1]),null!=c&&(l+=e.escape(c));break;case"text":l+=a[1]}return l},e.name="mustache.js",e.version="0.8.1",e.tags=["{{","}}"];var k=new d;e.clearCache=function(){return k.clearCache()},e.parse=function(e,t){return k.parse(e,t)},e.render=function(e,t,n){return k.render(e,t,n)},e.to_html=function(n,o,i,r){var s=e.render(n,o,i);return t(r)?void r(s):s},e.escape=r,e.Scanner=l,e.Context=p,e.Writer=d});