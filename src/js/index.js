function dpbox(t,e){this.defaults={width:"auto",height:"auto",overlay:"false",type:"Modal"},this.opts=$.extend(this.opts,this.defaults,e),this._create=function(){this.container||(this.container=$("<div/>",{"class":"dpbox"}).css("display","none").appendTo($("body")),this.header=$("<div/>",{"class":"dpbox-header"}).appendTo(this.container),this.title=$("<div/>",{"class":"dpbox-title"}).appendTo(this.header).css("display","inline"),this.clzBtn=$("<div/>",{"class":"dpbox-clzBtn"}).appendTo(this.header).html("X").css("display","inline").on("click",this.close.bind(this)),this.content=$("<div/>",{"class":"dpbox-content"}).css({width:this.opts.width,height:this.opts.height}).appendTo(this.container),this.setTitle(this.opts.title),this.setContent(this.opts.content),"Confirm"==this.opts.btn&&(this.bottom=$("<div/>",{"class":"dpbox-bottom"}).appendTo(this.container),this.setConfirmBtn()))},this.container||this._create()}$(function(){function t(t){$.ajax({url:w,type:"GET",dataType:"json",data:t,success:function(t){d&&u?($(t.dealist).each(function(t,e){e.imgUrl=e.imgUrl.replace("450c280","120c90"),e.geoLocations.length>1&&d?(e.value=[],$(e.geoLocations).each(function(t){e.value[t]=y.value({latitude:d,longitude:u},e.geoLocations[t])}),e.minValue=Math.min.apply(Math,e.value),e.distance=y.distance(e.minValue)):e.geoLocations[0]&&d&&(e.minValue=y.value({latitude:d,longitude:u},e.geoLocations[0]),e.distance=y.distance(e.minValue))}),t.dealist.sort(function(t,e){return t.minValue&&e.minValue?t.minValue-e.minValue:t.minValue?e.minValue?void 0:-1:1}),$(".detail-list").append(Mustache.render(dealTpl.deal,t)),$(".item").length>x&&$(".item").each(function(t){t+1>x&&$(".item").eq(t).hide()}),$(".check-more").on("click",function(){for(var t=x;x+k>t;t++)$(".item").eq(t).show();x+=k,(x>$(".item").length||x==$(".item").length)&&$(this).hide()})):($(".detail-list").append(Mustache.render(dealTpl.deal,t)),$(".item").length>x&&$(".item").each(function(t){t+1>x&&$(".item").eq(t).hide()}),$(".check-more").on("click",function(){for(var t=x;x+k>t;t++)$(".item").eq(t).show();(x>$(".item").length||x==$(".item").length)&&$(this).hide(),x+=k})),e()}})}function e(){var t={};t.couponRuleID=couponRuleID,t.dpid=c,$.cookie("dper")?t.dper=$.cookie("dper"):t.token=httpUtils.getParam("token"),$.ajax({async:!1,url:v,type:"GET",dataType:"jsonp",data:t,jsonp:"jsonp",success:function(t){t.success&&0==t.realtime_tg_fresh?$(".container.op-box").append('<img src="http://www.dpfile.com/mfchwl/img/lyhneww.png">'):($(".buy-btn").text("免费领"),$(".price strong").text("0")),n(t)},error:function(t){$(".buy-btn").text("免费领"),$(".price strong").text("0"),n(t)}})}function n(t){$(".item").on("click",function(e){e.preventDefault();var n=$(e.target).parents("a").attr("data-tuandealid"),o=g+"/tuan/eventdeal/"+n+"?"+h,i=g+"/tuan/eventdeal/"+n+"?"+f,r=g+"/tuan/deal/"+n;return l.replace(/\./,"")<68.5?(b.showOverlay(0),void b.centershow(".popbox")):0==t.success?void(location.href="dianping://loginweb?url="+encodeURIComponent(g+"/login/app?version="+l+"&logintype=m")+"&goto="+encodeURIComponent("dianping://complexweb?url="+encodeURIComponent(i))):0==t.realtime_tg_fresh?void(location.href=r):t.integrity_score<=0?($.removeCookie("dper"),void(location.href="dianping://loginweb?url="+encodeURIComponent(g+"/login/app?version="+l+"&logintype=m")+"&goto="+encodeURIComponent("dianping://complexweb?url="+encodeURIComponent(i)))):t.mobile?t.integrity_score>9980?void DPApp.show_alert({title:"提示",message:"活动爆棚啦，放眼望去人山人海，先喝口茶歇歇吧~",options:[],cancel:"好的"},function(){location.href="dianping://home"}):t.integrity_score>5e3&&t.integrity_score<=9980&&1==t.up_sms?void(location.href=m+"/lab/common/uploadSmsCheck?eventId="+couponRuleID+"&bizType=2&callback="+encodeURIComponent(o)):void(location.href=o):void(location.href="dianping://modifyphone?goto="+encodeURIComponent("dianping://complexweb?url="+i)+"&url="+encodeURIComponent(g+"/account/modifyMobile?newtoken=!"))})}function o(){t(),share.shareBtn(),share.initShare(),i.on("click",function(t){t.preventDefault(),b.showOverlay(1),$(".popbox").hide()}),r.on("click",function(t){return t.preventDefault(),window.location.href="http://m.dianping.com/download/synthesislink?redirect=3130&tag=external",!1})}var i=$(".j-back"),r=$(".j-update"),s=(httpUtils.getParam("eventId"),httpUtils.getParam("eventName")),a=httpUtils.getParam("cityid"),c=httpUtils.getParam("dpid"),l=httpUtils.getParam("version"),p=httpUtils.getParam("token"),d=httpUtils.getParam("latitude"),u=httpUtils.getParam("longitude");couponRuleID=httpUtils.getParam("couponRuleID"),env=httpUtils.getParam("env"),(void 0==typeof s||""==s)&&(s="mfchwlzs"),(void 0==typeof couponRuleID||""==couponRuleID)&&(couponRuleID="102201"),(void 0==typeof env||""==env)&&(env="product");var h="eventName="+s+"&cityid="+a+"&version="+l+"&token="+p+"&latitude="+d+"&longitude="+u+"&dpid="+c+"&couponRuleID="+couponRuleID+"&source=1",f="eventName="+s+"&cityid="+a+"&version="+l+"&token=*&latitude="+d+"&longitude="+u+"&dpid="+c+"&couponRuleID="+couponRuleID+"&source=1",g="http://m.dianping.com",m="http://t.dianping.com",v="http://mm.dianping.com/weixin/promotion/user-profile/jsonp",w="http://evt.dianping.com/mfchwl/json/"+a+".json";"product"!=env&&(w="http://evt.dianping.dp/mfchwlzs/json/"+a+".json",v="http://mm.51ping.com/weixin/promotion/user-profile/jsonp",g="http://m.51ping.com",m="http://t.51ping.com");var b={showOverlay:function(t){var e=$('<div id="J_overlay" style="position:absolute;left:0;top:0;background:#000;_filter:alpha(opacity=50);z-index:999;"></div>');t?$("#J_overlay").remove():e.appendTo($("body")).css({width:$(window).width(),height:"1700px",opacity:.5})},centershow:function(t){var e=($(window).height()-140)/2,n=($(window).width()-$(t).css("width").substring(0,3))/2,o=$(window).scrollTop()||0,i=$(window).scrollLeft()||0;$(t).css({position:"absolute",top:e+o,left:n+i}).show()}},y=new geo,x=10,k=100;o()});var dealTpl={deal:'{{#dealist}}<a class="J_deal" data-tuandealid="{{id}}">	 <div class="item">\n            <div class="pic">                <img src="{{imgUrl}}">            </div>            <div class="info">                <h3>{{dealGroupShortName}}<span class="geo">{{distance}}</span></h3>                <h4>{{recommendReason}}</h4>                <div class="buy-box Fix">                    <div class="price-box f-l">                        <span class="price">¥<strong>{{price}}</strong></span>                        <span class="o-price">¥<strong>{{marketPrice}}</strong></span>                    </div>                        <span class="buy-btn f-r">去团购</span>                </div>            </div>	  </div>\n        </a>{{/dealist}}'},callbacksCount=1,callbacks={};window.DPApp={send_message:function(t,e,n){var o=n&&"function"==typeof n,i=o?callbacksCount++:0;o&&(callbacks[i]=n),e.callbackId=i,e="object"==typeof e?JSON.stringify(e):e+"";var r="js://_?method="+t+"&args="+encodeURIComponent(e)+"&callbackId="+i,s=document.createElement("IFRAME");s.setAttribute("src",r),s.setAttribute("height","1px"),s.setAttribute("width","1px"),document.documentElement.appendChild(s),s.parentNode.removeChild(s),s=null},callback:function(t,e){try{var n=callbacks[t];if(!n)return;n.apply(null,[e])}catch(o){alert(o)}},show_alert:function(t,e){DPApp.send_message("show_alert",t,function(t){e instanceof Function&&e(t.select)})},send_sms:function(t,e){DPApp.send_message("send_sms",{content:t,recipients:e})},open_web:function(t,e){DPApp.send_message("open_web",{modal:t,url:e})},close_web:function(t){DPApp.send_message("close_web",{modal:t})},shareConfig:{url:"http://t1.dpfile.com/t/html/app/events/zonefreeeating1017/index.html?"+ +new Date,image:"http://i1.s1.dpfile.com/pc/tgzt/5e6bd31183e7f5ea30ec611bddc9dfae(1600c550)/thumb.jpg",title:"大众点评豪掷10亿，请新用户免费吃喝玩乐",desc:"吃喝玩乐，通通不要钱，大众点评新用户专享!"}},dpbox.prototype.setContent=function(t){(null!=t||this.container)&&this.content.html(t)},dpbox.prototype.setTitle=function(t){(null!=t||this.container)&&this.title.html(t)},dpbox.prototype.setConfirmBtn=function(){var t="<div class='buttons'><a href='' class='bn-yel bn-sm'>确定</a><a href='' class='bn-ash bn-sm'>取消</a></div>";this.bottom.html(t)},dpbox.prototype.open=function(){var t=function(){var t=($(window).height()-$(this.container).height())/2,e=($(window).width()-$(this.container).width())/2,n=$(document).scrollTop(),o=$(document).scrollLeft();$(this.container).css({position:"absolute",top:t+n,left:e+o}).show()}.bind(this);this.Opening?t():(this.Opening=!this.Opening,this.opts.overlay&&(this.overlay=$('<div style="background-color: rgb(0, 0, 0); border-top-width: 1px; border-top-style: solid; border-top-color: rgb(0, 0, 0); position: absolute; height: 1557px;width: 100%; left: 0px; top: 0px; opacity: 0.7; tp-a"></div>').appendTo($("body"))),t())},dpbox.prototype.close=function(){this.Opening?(this.Opening=!this.Opening,this.opts.overlay&&this.overlay.css({display:"none"}),this.container.css({display:"none"})):this.container.css({display:"none",opacity:0})},$.dpbox=function(t,e){return e||(e={}),new dpbox(t,$.extend(e,$.fn.dpbox.defaults))};var geo=function(){},proto=geo.prototype;proto.constructor=geo,proto.distance=function(t){if(t>1){var e=t-t%1;return">"+e.toString()+"km"}var n=parseInt(1e3*t);return n.toString()+"m"},proto.value=function(t,e){var n=Math.PI/180,o=(180/Math.PI,6371),i=2*o,r=t.latitude,s=t.longitude,a=e.latitude,c=e.longitude,l=a*n,p=c*n,d=r*n-l,u=s*n-p,h=Math.sin(.5*d),f=Math.sin(.5*u),g=Math.cos(r*n),m=h*h+g*Math.cos(l)*f*f;return i*Math.atan2(Math.sqrt(m),Math.sqrt(1-m))},proto.getLocation=function(t,e){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){window.latitude=e.coords.latitude,window.longitude=e.coords.longitude,t&&t instanceof Function&&t()},function(){e&&e instanceof Function&&e()}):console.log("Geolocation is not supported by this browser.")};var httpUtils={getParam:function(t){var e="";if(isFound=!1,0==window.location.search.indexOf("?")&&window.location.search.indexOf("=")>1)for(arrSource=unescape(window.location.search).substring(1,window.location.search.length).split("&"),i=0;i<arrSource.length&&!isFound;)arrSource[i].indexOf("=")>0&&arrSource[i].split("=")[0].toLowerCase()==t.toLowerCase()&&(e=arrSource[i].split("=")[1],isFound=!0),i++;return e}},lazyAttr="lazy-src",LazyLoad=function(t){var e=t.get().filter(function(t){return!!$(t).attr(lazyAttr)}),n=e.length,o=function(){for(var t=$(window).scrollTop()+window.innerHeight,i=0,r=e.length;r>i;i++){var s=$(e[i]);!s.attr("src")&&s.attr(lazyAttr)&&t>$(s).offset().top&&(s.attr("src",s.attr(lazyAttr)),n--)}0>=n&&window.removeEventListener("scroll",o,!1)};window.addEventListener("load",o,!1),window.addEventListener("scroll",o,!1),o()},share={shareBtn:function(){var t=document.createElement("div");t.style.display="none",t.innerHTML='<div id="shareBox" class="share-tips"><i></i><p>点击右上角按钮分享给好友</p></div>',document.body.appendChild(t),t.addEventListener("click",function(){t.style.display="none"}),$("#J_guide_share").on("click",function(e){e.preventDefault(),t.style.display="block"})},initShare:function(){var t=document.createElement("iframe"),e=document.createElement("div"),n="dpshare://_?content="+encodeURIComponent(JSON.stringify(DPApp.shareConfig));e.setAttribute("style","display:none"),e.appendChild(t),document.body.appendChild(e),t.setAttribute("src",n)}};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):Zepto)}(function(t){function e(t){return a.raw?t:encodeURIComponent(t)}function n(t){return a.raw?t:decodeURIComponent(t)}function o(t){return e(a.json?JSON.stringify(t):String(t))}function i(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(s," ")),a.json?JSON.parse(t):t}catch(e){}}function r(e,n){var o=a.raw?e:i(e);return t.isFunction(n)?n(o):o}var s=/\+/g,a=t.cookie=function(i,s,c){if(arguments.length>1&&!t.isFunction(s)){if(c=t.extend({},a.defaults,c),"number"==typeof c.expires){var l=c.expires,p=c.expires=new Date;p.setTime(+p+864e5*l)}return document.cookie=[e(i),"=",o(s),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}for(var d=i?void 0:{},u=document.cookie?document.cookie.split("; "):[],h=0,f=u.length;f>h;h++){var g=u[h].split("="),m=n(g.shift()),v=g.join("=");if(i&&i===m){d=r(v,s);break}i||void 0===(v=r(v))||(d[m]=v)}return d};a.defaults={},t.removeCookie=function(e,n){return void 0===t.cookie(e)?!1:(t.cookie(e,"",t.extend({},n,{expires:-1})),!t.cookie(e))}}),function(t,e){"object"==typeof exports&&exports?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Mustache={})}(this,function(t){function e(t){return"function"==typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return f.call(t,e)}function i(t){return!o(g,t)}function r(t){return String(t).replace(/[&<>"'\/]/g,function(t){return m[t]})}function s(e,o){function r(){if($&&!k)for(;m.length;)delete g[m.pop()];else m=[];$=!1,k=!1}function s(t){if("string"==typeof t&&(t=t.split(w,2)),!h(t)||2!==t.length)throw new Error("Invalid tags: "+t);p=new RegExp(n(t[0])+"\\s*"),d=new RegExp("\\s*"+n(t[1])),u=new RegExp("\\s*"+n("}"+t[1]))}if(!e)return[];var p,d,u,f=[],g=[],m=[],$=!1,k=!1;s(o||t.tags);for(var U,C,I,_,R,T,j=new l(e);!j.eos();){if(U=j.pos,I=j.scanUntil(p))for(var D=0,P=I.length;P>D;++D)_=I.charAt(D),i(_)?m.push(g.length):k=!0,g.push(["text",_,U,U+1]),U+=1,"\n"===_&&r();if(!j.scan(p))break;if($=!0,C=j.scan(x)||"name",j.scan(v),"="===C?(I=j.scanUntil(b),j.scan(b),j.scanUntil(d)):"{"===C?(I=j.scanUntil(u),j.scan(y),j.scanUntil(d),C="&"):I=j.scanUntil(d),!j.scan(d))throw new Error("Unclosed tag at "+j.pos);if(R=[C,I,U,j.pos],g.push(R),"#"===C||"^"===C)f.push(R);else if("/"===C){if(T=f.pop(),!T)throw new Error('Unopened section "'+I+'" at '+U);if(T[1]!==I)throw new Error('Unclosed section "'+T[1]+'" at '+U)}else"name"===C||"{"===C||"&"===C?k=!0:"="===C&&s(I)}if(T=f.pop())throw new Error('Unclosed section "'+T[1]+'" at '+j.pos);return c(a(g))}function a(t){for(var e,n,o=[],i=0,r=t.length;r>i;++i)e=t[i],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(o.push(e),n=e));return o}function c(t){for(var e,n,o=[],i=o,r=[],s=0,a=t.length;a>s;++s)switch(e=t[s],e[0]){case"#":case"^":i.push(e),r.push(e),i=e[4]=[];break;case"/":n=r.pop(),n[5]=e[2],i=r.length>0?r[r.length-1][4]:o;break;default:i.push(e)}return o}function l(t){this.string=t,this.tail=t,this.pos=0}function p(t,e){this.view=null==t?{}:t,this.cache={".":this.view},this.parent=e}function d(){this.cache={}}var u=Object.prototype.toString,h=Array.isArray||function(t){return"[object Array]"===u.call(t)},f=RegExp.prototype.test,g=/\S/,m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},v=/\s*/,w=/\s+/,b=/\s*=/,y=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},l.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},p.prototype.push=function(t){return new p(t,this)},p.prototype.lookup=function(t){var n,o=this.cache;if(t in o)n=o[t];else{for(var i,r,s=this;s;){if(t.indexOf(".")>0)for(n=s.view,i=t.split("."),r=0;null!=n&&r<i.length;)n=n[i[r++]];else n=s.view[t];if(null!=n)break;s=s.parent}o[t]=n}return e(n)&&(n=n.call(this.view)),n},d.prototype.clearCache=function(){this.cache={}},d.prototype.parse=function(t,e){var n=this.cache,o=n[t];return null==o&&(o=n[t]=s(t,e)),o},d.prototype.render=function(t,e,n){var o=this.parse(t),i=e instanceof p?e:new p(e);return this.renderTokens(o,i,n,t)},d.prototype.renderTokens=function(n,o,i,r){function s(t){return p.render(t,o,i)}for(var a,c,l="",p=this,d=0,u=n.length;u>d;++d)switch(a=n[d],a[0]){case"#":if(c=o.lookup(a[1]),!c)continue;if(h(c))for(var f=0,g=c.length;g>f;++f)l+=this.renderTokens(a[4],o.push(c[f]),i,r);else if("object"==typeof c||"string"==typeof c)l+=this.renderTokens(a[4],o.push(c),i,r);else if(e(c)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");c=c.call(o.view,r.slice(a[3],a[5]),s),null!=c&&(l+=c)}else l+=this.renderTokens(a[4],o,i,r);break;case"^":c=o.lookup(a[1]),(!c||h(c)&&0===c.length)&&(l+=this.renderTokens(a[4],o,i,r));break;case">":if(!i)continue;c=e(i)?i(a[1]):i[a[1]],null!=c&&(l+=this.renderTokens(this.parse(c),o,i,c));break;case"&":c=o.lookup(a[1]),null!=c&&(l+=c);break;case"name":c=o.lookup(a[1]),null!=c&&(l+=t.escape(c));break;case"text":l+=a[1]}return l},t.name="mustache.js",t.version="0.8.1",t.tags=["{{","}}"];var $=new d;t.clearCache=function(){return $.clearCache()},t.parse=function(t,e){return $.parse(t,e)},t.render=function(t,e,n){return $.render(t,e,n)},t.to_html=function(n,o,i,r){var s=t.render(n,o,i);return e(r)?void r(s):s},t.escape=r,t.Scanner=l,t.Context=p,t.Writer=d});